---
import Footer from '../components/Footer.astro';
import Header from '../components/Header.astro';
import SEO from '../components/SEO.astro';
import '../styles/global.css';
import { layoutTokens } from '../utils/layoutTokens';

export interface Props {
	title?: string;
	description?: string;
	image?: { src: string; width?: number; height?: number };
	type?: 'website' | 'article';
	publishedDate?: Date;
	currentSlug?: string;
	/** Comic IDs to prefetch vote data for during HTML parse (before JS loads) */
	earlyVoteIds?: string[];
}

const { title, description, image, type, publishedDate, currentSlug, earlyVoteIds } = Astro.props;
const earlyVoteParam = earlyVoteIds?.join(',');
const defaultImage = {
	src: '/leconceptdelapreuve.png',
	width: 1260,
	height: 630,
};
const ogImage = image ?? defaultImage;
const layoutStyle = `--page-max: ${layoutTokens.pageMaxRem}rem; --page-pad: ${layoutTokens.pagePadRem}rem; --comic-gap: ${layoutTokens.comicGapRem}rem; --comic-margin: ${layoutTokens.comicMarginRem}rem;`;
---

<!doctype html>
<html lang="fr">
	<head>
		<link rel="preconnect" href="https://fonts.googleapis.com" />
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
		<link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Inconsolata:wght@400;600&display=swap" />
		<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inconsolata:wght@400;600&display=swap" media="print" onload="this.media='all'" />
		<noscript><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inconsolata:wght@400;600&display=swap" /></noscript>
		{earlyVoteParam && (
			<script is:inline define:vars={{ earlyVoteParam }}>
				window.__votePromise = fetch('/api/vote?comic=' + earlyVoteParam);
			</script>
		)}
		<SEO
			title={title}
			description={description}
			image={ogImage}
			type={type}
			publishedDate={publishedDate}
		/>
		{/* Umami analytics â€” only in production.
				To exclude yourself: localStorage.setItem('umami.disabled', 1) in DevTools */}
		{import.meta.env.PROD && (
			<script
				is:inline
				defer
				src="https://cloud.umami.is/script.js"
				data-website-id="892c8f89-23df-469b-9177-76c7063729e2"></script>
		)}
	</head>
	<body class="min-h-screen bg-[#fdfdfd] text-zinc-900 font-sans">
		<div class="page-shell grid min-h-screen grid-rows-[auto_1fr_auto]" style={layoutStyle}>
			<Header currentSlug={currentSlug} />
			<main>
				<slot />
			</main>
			<Footer />
		</div>
	</body>
	<script>
		import { initFadeInImages } from "@scripts/animations";
		import { initVote } from "@scripts/vote";
		initFadeInImages();
		initVote();
	</script>
</html>
