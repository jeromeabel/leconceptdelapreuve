---
import { getCollection } from 'astro:content';
import { Picture } from 'astro:assets';
import Layout from '../layouts/Layout.astro';
import ActionPanel from '../components/ActionPanel.astro';

const comics = await getCollection('comics');
const latestComic = comics
	.sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf())
	.at(0);
---

<Layout ogImage={latestComic?.data.cover.src}>
	{latestComic ? (
		<article>
			<div class="grid grid-cols-1 gap-2 md:grid-cols-2">
				{latestComic.data.pages.map((page, i) => (
					<Picture
						src={page}
						formats={['avif', 'webp']}
						alt={`${latestComic.data.alt} — page ${i + 1}`}
						class="w-full h-auto"
						loading={i === 0 ? 'eager' : 'lazy'}
					/>
				))}
			</div>
			<ActionPanel
				date={latestComic.data.date}
				slug={latestComic.id}
				title={latestComic.data.title}
			/>
		</article>
	) : (
		<p class="text-zinc-500">Aucune bande dessinée pour le moment.</p>
	)}
</Layout>
