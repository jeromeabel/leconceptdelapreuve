---
import type { CollectionEntry } from 'astro:content';
import ComicImage from './ComicImage.astro';
import VoteButton from './VoteButton.astro';
import ShareActions from './ShareActions.astro';
import { Icon } from 'astro-icon/components';

interface Props {
	comic: CollectionEntry<'comics'>;
	eager?: boolean;
}

const { comic, eager = false } = Astro.props;
const formattedDate = comic.data.date.toLocaleDateString('fr-FR', {
	day: '2-digit',
	month: '2-digit',
	year: 'numeric',
});
---

<div>
	<!-- Paper: images only, no chrome inside -->
	<!-- px-6 / md:px-12 / border must match layoutTokens cardPad*Rem and cardBorderPx -->
	<article class="px-6 py-6 md:px-12 md:py-8 border border-zinc-300 shadow-lg">
		<div class="comic-grid grid grid-cols-1 md:grid-cols-2">
			{comic.data.pages.map((page, i) => (
				<ComicImage
					src={page}
					alt={`${comic.data.alt} — page ${i + 1}`}
					eager={eager}
				/>
			))}
		</div>
	</article>

	<!-- Label strip: below the paper, outside the shadow -->
	<div class="flex items-center gap-x-3 pt-2 md:pt-3 text-sm text-zinc-500">
		<span class="text-zinc-800 shrink-0">{comic.id}</span>
		<span class="text-zinc-300" aria-hidden="true">·</span>
		<span class="min-w-0 truncate">{comic.data.title}</span>
		<time datetime={comic.data.date.toISOString()} class="text-zinc-400 shrink-0">{formattedDate}</time>
		<div class="ml-auto flex items-center shrink-0">
			<VoteButton slug={comic.id} />
			<ShareActions slug={comic.id} title={comic.data.title} />
			<a
				href={`/${comic.id}`}
				class="no-underline inline-flex items-center justify-center p-2 text-zinc-600 hover:text-zinc-900 transition-colors"
				aria-label="Permalien"
				data-umami-event="click-permalink"
				data-umami-event-comic={comic.id}
			>
				<Icon name="carbon:link" class="size-4" aria-hidden="true" />
			</a>
		</div>
	</div>
</div>
