---
import type { CollectionEntry } from 'astro:content';
import ComicImage from './ComicImage.astro';
import VoteButton from './VoteButton.astro';
import ShareActions from './ShareActions.astro';

interface Props {
	comic: CollectionEntry<'comics'>;
	eager?: boolean;
}

const { comic, eager = false } = Astro.props;
const formattedDate = comic.data.date.toLocaleDateString('fr-FR', {
	day: '2-digit',
	month: '2-digit',
	year: 'numeric',
});
---

<div>
	<!-- Paper: images only, no chrome inside -->
	<!-- px-6 / md:px-12 / border must match layoutTokens cardPad*Rem and cardBorderPx -->
	<article class="p-6 md:p-12 border border-zinc-300 shadow-lg">
		<div class="comic-grid grid grid-cols-1 md:grid-cols-2">
			{comic.data.pages.map((page, i) => (
				<ComicImage
					src={page}
					alt={`${comic.data.alt} — page ${i + 1}`}
					eager={eager}
				/>
			))}
		</div>
	</article>

	<!-- Label strip -->
	<div class="flex gap-2 pt-3 items-center gap-x-3 text-sm justify-between">

		<!-- Info: id · title · date -->
		<div class="flex flex-col md:flex-row gap-x-2">
			<a
				href={`/${comic.id}`}
				data-umami-event="click-permalink"
				data-umami-event-comic={comic.id}
				class="no-underline text-zinc-950 hover:text-zinc-600"
				title={`Ouvrir la page du dessin "${comic.data.title}"`}
			>
				{comic.id} <span aria-hidden="true" class="text-zinc-400">·</span> {comic.data.title}
			</a>
			<div>
				<span class="shrink-0 text-zinc-400 hidden md:inline-block" aria-hidden="true">·</span>
				<time datetime={comic.data.date.toISOString()} class="shrink-0 text-zinc-400">
					{formattedDate}
				</time>
			</div>
		</div>

		<!-- Actions -->
		<div class="flex shrink-0 gap-3">
			<VoteButton slug={comic.id} />
			<ShareActions slug={comic.id} title={comic.data.title} />
		</div>
	</div>
</div>
